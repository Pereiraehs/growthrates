<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Thomas Petzoldt" />

<meta name="date" content="2017-02-05" />

<title>Estimation of Growth Rates with Package growthrates, Part 2: User-defined Growth Models</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Estimation of Growth Rates with Package <code>growthrates</code>, Part 2: User-defined Growth Models</h1>
<h4 class="author"><em>Thomas Petzoldt</em></h4>
<h4 class="date"><em>2017-02-05</em></h4>



<!--
possible output options are:
rmarkdown::pdf_document
rmarkdown::html_vignette

set to UTF if necessary with:
%\VignetteEncoding{UTF-8}

Bibliographies may need to set the LANG environment variable
LANG=en_US.UTF-8
-->
<div id="introduction" class="section level1">
<h1>1. Introduction</h1>
<p>Package <strong>growthrates</strong> comes with a set of pararametric growth models built-in, that should be sufficient for many application scenarios, but of course not under all circumstances. This document describes how the set of available functions can be extended with own user-defined models. Section (3) describes how simple regression functions existing in a <em>closed form</em> can be implemented. In Section (4) we will see how growth models defined by systems of ordinary differential equations (ODE) can be implemented directy in R and finally Section (5) describes how ODE models can be implemented as C inline functions.</p>
</div>
<div id="differential-equations-or-closed-form" class="section level1">
<h1>2. Differential equations or closed form?</h1>
<p>Growth models can be either “ordinary functions” of time <span class="math inline">\(f(t)\)</span> in <em>closed form</em>, that a allow to get values for the dependend variable <span class="math inline">\(y\)</span> immediately from any given value of an independent variable <span class="math inline">\(t\)</span> (or <span class="math inline">\(time\)</span>) without the need of iteration. Or, they can be a differential equation model <span class="math inline">\(dy/dt\)</span> that needs numerical integration.</p>
<p>Sometimes, a model can be given in either of these forms. As an example, the logistic growth model can be written as a differential equation:</p>
<p><span class="math display">\[\frac{dy}{dt} = \mu_{max} \cdot y \left(1 - \frac{y}{K}\right)\]</span></p>
<p>or as its analytical solution in closed form:</p>
<p><span class="math display">\[y(t) = \frac{K \cdot y_0}{y_0 + (K - y_0) \cdot e^{-\mu_{max} \cdot t}}\]</span></p>
<p>We see, that it is much easier to use the second form, because <span class="math inline">\(y\)</span> can immediately be calculated from <span class="math inline">\(t\)</span>, while for the first version, we would need either calculus (and get the second form as its solution), or we could use a numerical method to simulate the evolution of <span class="math inline">\(y\)</span> stepwise over time.</p>
<p>But on the other hand, models given as differential equations are often more directly related to a mechanistic process description and easier to extended.</p>
</div>
<div id="growth-models-in-closed-form" class="section level1">
<h1>3. Growth models in closed form</h1>
<p>Let’s assume we want to extend the logistic growth model with an additional shift parameter in <span class="math inline">\(y\)</span> direction, for example, because a part of the population does not participate growing. This leads to an equation like:</p>
<p><span class="math display">\[y(t) = \frac{K \cdot y_0}{y_0 + (K - y_0) \cdot e^{-\mu_{max} t}} + y_{shift}\]</span></p>
<p>After loading package growthrates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;growthrates&quot;</span>)</code></pre></div>
<p>we can immediately define our own function in the user workspace, without modifying the package itself. In order to make it compatible with package growthrates, it is sufficient to streamline the input and output interfaces in the style described in help page <code>?growthmodel</code>.</p>
<p>The function can have any valid name, but:</p>
<ol style="list-style-type: decimal">
<li>it must have exactly two arguments <strong>time</strong> and <strong>parms</strong> as input and</li>
<li>its return value (output) must be a matrix with at least 3 columns with the column names <code>time</code>, <code>y</code> and <code>log_y</code>.</li>
</ol>
<p>The inner part of the function can be adapted as necessary, as long as the connection between input and output makes sense from a scientific viewpoint.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grow_logistic_yshift &lt;-<span class="st"> </span>function(time, parms) {
  <span class="kw">with</span>(<span class="kw">as.list</span>(parms), {
    y &lt;-<span class="st"> </span>(K *<span class="st"> </span>y0) /<span class="st"> </span>(y0 +<span class="st"> </span>(K -<span class="st"> </span>y0) *<span class="st"> </span><span class="kw">exp</span>(-mumax *<span class="st"> </span>time)) +<span class="st"> </span>y_shift
    <span class="kw">as.matrix</span>(<span class="kw">data.frame</span>(<span class="dt">time =</span> time, <span class="dt">y =</span> y, <span class="dt">log_y =</span> <span class="kw">log</span>(y)))
  })
}</code></pre></div>
<p>The, at a first look circumstantial <code>as.matrix(data.frame(()))</code> construction is a simple way to create the required output format. Then it is of course a good idea to test the function beforehand, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">time &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">10</span>
out &lt;-<span class="st"> </span><span class="kw">grow_logistic_yshift</span>(time, <span class="dt">parms =</span> <span class="kw">list</span>(<span class="dt">y0 =</span> <span class="dv">1</span>, <span class="dt">mumax =</span> <span class="fl">0.5</span>, <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">y_shift =</span> <span class="dv">2</span>))
<span class="kw">plot</span>(time, out[, <span class="st">&quot;y&quot;</span>], <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>)</code></pre></div>
<p>Future versions of the growthrates package may introduce additional checks, so it is already a good idea to convert the function into an appropriate object of class <code>growthmodel</code> with a so-called constructor function of the same name:</p>
<pre><code>grow_logistic_yshift &lt;- growthmodel(grow_logistic_yshift,
                                    c(&quot;y0&quot;, &quot;mumax&quot;, &quot;K&quot;, &quot;y_shift&quot;))</code></pre>
<p>Now the new model is ready to be fitted to test data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">5</span>)
y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">2.3</span>, <span class="dv">5</span>, <span class="fl">4.7</span>, <span class="fl">4.3</span>, <span class="fl">6.9</span>, <span class="fl">8.2</span>, <span class="fl">11.5</span>, <span class="fl">8.8</span>, <span class="fl">10.2</span>, <span class="fl">14.5</span>, <span class="fl">12.5</span>,
       <span class="fl">13.6</span>, <span class="fl">12.7</span>, <span class="fl">14.2</span>, <span class="fl">12.5</span>, <span class="fl">13.8</span>, <span class="fl">15.1</span>, <span class="fl">12.7</span>, <span class="fl">14.9</span>)

fit &lt;-<span class="st"> </span><span class="kw">fit_growthmodel</span>(grow_logistic_yshift,
                       <span class="dt">p =</span> <span class="kw">c</span>(<span class="dt">y0 =</span> <span class="dv">1</span>, <span class="dt">mumax =</span> <span class="fl">0.1</span>, <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">y_shift =</span> <span class="dv">1</span>),
                       <span class="dt">time =</span> x, <span class="dt">y =</span> y)
<span class="kw">plot</span>(fit)
<span class="kw">summary</span>(fit)</code></pre></div>
</div>
<div id="differential-equation-models-in-r" class="section level1">
<h1>4. Differential equation models in R</h1>
<p>Differential equation models can be used quite similar to this. It is a little bit more complex because:</p>
<ol style="list-style-type: decimal">
<li>we need two functions. One for the ODE model (the derivatives) and one for the numerical integration.</li>
<li>the ODE model distinguishes between time dependent <em>state variables</em> and constant <em>parameters</em>, that can both be considered as <em>parameters</em> in a statistical sense. This distinction between <strong>statistical parameters</strong> (from the viewpoint of model fitting) and <strong>ODE model parameters</strong> should not be confused.</li>
<li>the numerical integration is itself is a broad field that needs experience and care. A short overview on this topic can be found in <span class="citation">Soetaert, Petzoldt, and Setzer (2010)</span>.</li>
</ol>
<p>In the following, let’s assume a model where the carrying capacity is a function of time. This can be modelled with a system of two differential equations, one for the carrying capacity (<span class="math inline">\(K\)</span>) and another for the population abundance (<span class="math inline">\(y\)</span>). For sake of simplicity we assume a linear increase of <span class="math inline">\(K\)</span>, but more complex models are of course also possible, e.g. biochemical conversion of a mixed substrate, Monod-dependency from a limited resource, density dependence or a semi-continuos addition of nutrients.</p>
<p>The growth model is built from two parts:</p>
<ol style="list-style-type: decimal">
<li>the function <code>ode_...</code> with the differential equations, and</li>
<li>the growth model <code>grow_...</code> calculating the numerical solution.</li>
</ol>
<p>In the latter, the statistical parameters are splitted into the initial values for the states (<code>init</code>) and the ODE model parameters. And, we need to distinguish between the initial (start) values, e.g. <span class="math inline">\(y_0\)</span> and the state variables <span class="math inline">\(y\)</span> that change during simulation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ode_K_linear &lt;-<span class="st"> </span>function (time, init, parms, ...) {
  <span class="kw">with</span>(<span class="kw">as.list</span>(<span class="kw">c</span>(parms, init)), {
    dy &lt;-<span class="st"> </span>mumax *<span class="st"> </span>y *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>y/K)
    dK &lt;-<span class="st"> </span>dK
    <span class="kw">list</span>(<span class="kw">c</span>(dy, dK), <span class="dt">log_y =</span> <span class="kw">unname</span>(<span class="kw">log</span>(y)))
  })
}

grow_K_linear &lt;-<span class="st"> </span>function(time, parms, ...) {
  init    &lt;-<span class="st"> </span>parms[<span class="kw">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;K&quot;</span>)]           <span class="co"># initial values</span>
  <span class="kw">names</span>(init) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;K&quot;</span>)               <span class="co"># force names of state variables</span>
  odeparms &lt;-<span class="st"> </span>parms[<span class="kw">c</span>(<span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;dK&quot;</span>)]      <span class="co"># the parms of the ODE model</span>
  out &lt;-<span class="st"> </span><span class="kw">ode</span>(init, time, ode_K_linear, <span class="dt">parms =</span> odeparms)
  out
}</code></pre></div>
<p>Again, it’s a good idea to test this first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grow_K_linear &lt;-<span class="st"> </span><span class="kw">growthmodel</span>(grow_K_linear,
                             <span class="dt">pnames =</span> <span class="kw">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;deltaK&quot;</span>))
<span class="kw">head</span>(<span class="kw">grow_K_linear</span>(<span class="dt">time =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="kw">c</span>(<span class="dt">y0 =</span> .<span class="dv">1</span>, <span class="dt">K =</span> <span class="dv">1</span>, <span class="dt">mumax =</span> <span class="fl">0.1</span>, <span class="dt">dK =</span> <span class="fl">0.5</span>)))</code></pre></div>
<p>before we fit the model to data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">5</span>)
y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">2.2</span>, <span class="fl">3.1</span>, <span class="fl">1.5</span>, <span class="fl">8.9</span>, <span class="dv">8</span>, <span class="fl">8.4</span>, <span class="fl">9.8</span>, <span class="fl">9.3</span>, <span class="fl">10.6</span>, <span class="dv">12</span>, <span class="fl">13.6</span>,
  <span class="fl">13.1</span>, <span class="fl">13.3</span>, <span class="fl">11.6</span>, <span class="fl">14.7</span>, <span class="fl">12.6</span>, <span class="fl">13.9</span>, <span class="fl">16.9</span>, <span class="fl">14.4</span>)
fit &lt;-<span class="st"> </span><span class="kw">fit_growthmodel</span>(grow_K_linear,
                       <span class="dt">p =</span> <span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">0.1</span>, <span class="dt">mumax =</span> <span class="fl">0.2</span>, <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">dK =</span> .<span class="dv">1</span>), <span class="dt">time =</span> x, <span class="dt">y =</span> y)
<span class="kw">plot</span>(fit)
<span class="kw">summary</span>(fit)</code></pre></div>
</div>
<div id="inline-c-code-with-package-code" class="section level1">
<h1>5. Inline C code with package cOde</h1>
<p>A numerical simulation of ODE models can sometimes be slow, so we may be tempted to speed it up. This is indeed possible with <em>compiled code</em>, i.e. the model is written in another programming language (Fortran or C) that are faster compared to R. Several methods exist how this can be done, see for example <span class="citation">Soetaert, Petzoldt, and Setzer (2010)</span> or <span class="citation">Kneis (2016)</span>. In the following, we use a method that allows <em>inline code</em>, i.e. direkt integration of C code in the R script using package <strong>cOde</strong> <span class="citation">(Kaschek 2016)</span>.</p>
<p>Note, however, that compiled code needs the necessary C (and/or Fortran) compilers and some additional developer tools. These are often installed on Linux systems by default, whereas the Windows toolset available from <a href="https://cran.r-project.org/bin/windows/Rtools/" class="uri">https://cran.r-project.org/bin/windows/Rtools/</a> needs an additional installation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## The following example shows how to use compiled growth models
## from inline code, by using the 'cOde' package of Daniel Kaschek
## Note: This example needs the R development tools.
##  - suitable compilers on Linux and Mac
##  - Rtools on Windows from https://cran.r-project.org/bin/windows/Rtools/

<span class="kw">library</span>(<span class="st">&quot;growthrates&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;cOde&quot;</span>)

## define a system of ODEs and compile it --------------------------------------
ode_K_linear &lt;-<span class="st"> </span><span class="kw">funC</span>(<span class="kw">c</span>(
  <span class="dt">y =</span> <span class="st">&quot;mumax * y * (1-y/K)&quot;</span>,
  <span class="dt">K =</span> <span class="st">&quot;dK&quot;</span>
))

yini &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">K =</span> <span class="dv">10</span>)
parms =<span class="st"> </span><span class="kw">c</span>(<span class="dt">mumax =</span> <span class="fl">0.1</span>, <span class="dt">dK =</span> <span class="fl">0.05</span>)

## run the model
out1 &lt;-<span class="st"> </span><span class="kw">odeC</span>(yini, <span class="dt">times =</span> <span class="dv">0</span>:<span class="dv">100</span>, ode_K_linear, <span class="dt">parms =</span> parms)

## generate artificial test data with normal distributed noise
x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">5</span>)
y &lt;-<span class="st"> </span><span class="kw">odeC</span>(yini, x, ode_K_linear, parms)[, <span class="st">&quot;y&quot;</span>] +<span class="st"> </span><span class="kw">rnorm</span>(x)


## create a &quot;growthmodel&quot; with interfaces compatible to package growthrates
## It is essential to use consistent names for parameters and initial values!

grow_K_linear &lt;-<span class="st"> </span>function(time, parms, ...) {
  init    &lt;-<span class="st"> </span>parms[<span class="kw">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;K&quot;</span>)]  <span class="co"># initial values</span>
  <span class="kw">names</span>(init) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;K&quot;</span>)      <span class="co"># force names</span>
  out &lt;-<span class="st"> </span><span class="kw">odeC</span>(init, time, ode_K_linear, parms)
  <span class="kw">cbind</span>(out, <span class="dt">log_y =</span> <span class="kw">log</span>(out[, <span class="st">&quot;y&quot;</span>]))
}

## convert this to an object, (maybe needed by future extensions)
grow_K_linear &lt;-<span class="st"> </span><span class="kw">growthmodel</span>(grow_K_linear, <span class="dt">pnames =</span> <span class="kw">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;dK&quot;</span>))

## Test the growthmodel
## Columns with names 'time', 'y' and 'log_y' are mandatory.
<span class="kw">head</span>(<span class="kw">grow_K_linear</span>(<span class="dt">time =</span> x, <span class="kw">c</span>(<span class="dt">y0 =</span> <span class="dv">1</span>, <span class="dt">mumax =</span> <span class="fl">0.1</span>, <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">dK =</span> <span class="fl">0.1</span>)))


## Fit the model ---------------------------------------------------------------
fit &lt;-<span class="st"> </span><span class="kw">fit_growthmodel</span>(grow_K_linear,
                       <span class="dt">p =</span> <span class="kw">c</span>(<span class="dt">y0 =</span> <span class="dv">1</span>, <span class="dt">mumax =</span> <span class="fl">0.1</span>, <span class="dt">K =</span> <span class="dv">10</span>, <span class="dt">dK =</span> <span class="fl">0.1</span>), <span class="dt">time =</span> x, <span class="dt">y =</span> y)
<span class="kw">plot</span>(fit)
<span class="kw">summary</span>(fit)

## Unload DLL and cleanup ------------------------------------------------------
## DLL creation should ideally be directed to a temporary directory.
dll &lt;-<span class="st"> </span><span class="kw">paste</span>(ode_K_linear, .Platform$dynlib.ext, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
<span class="kw">dyn.unload</span>(dll)
<span class="kw">unlink</span>(dll)
<span class="kw">unlink</span>(<span class="kw">paste</span>(ode_K_linear, <span class="st">&quot;.c&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))
<span class="kw">unlink</span>(<span class="kw">paste</span>(ode_K_linear, <span class="st">&quot;.o&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</code></pre></div>
</div>
<div id="acknowledgments" class="section level1">
<h1>Acknowledgments</h1>
<p>Many thanks to Claudia Seiler for the data set, to David Kneis for fruitful discussions, to Daniel Kaschek for his <strong>cOde</strong> package, and to the R Core Team <span class="citation">(R Core Team 2015)</span> for developing and maintaining <strong>R</strong>. This documentation was written using <strong>knitr</strong> <span class="citation">(Xie 2014)</span> and <strong>rmarkdown</strong> <span class="citation">(Allaire et al. 2015)</span>.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-rmarkdown">
<p>Allaire, JJ, Joe Cheng, Yihui Xie, Jonathan McPherson, Winston Chang, Jeff Allen, Hadley Wickham, and Rob Hyndman. 2015. <em>rmarkdown: Dynamic Documents for R</em>. <a href="http://CRAN.R-project.org/package=rmarkdown" class="uri">http://CRAN.R-project.org/package=rmarkdown</a>.</p>
</div>
<div id="ref-Kaschek2016">
<p>Kaschek, Daniel. 2016. <em>cOde: Automated C Code Generation for Use with the deSolve and bvpSolve Packages</em>. <a href="https://CRAN.R-project.org/package=cOde" class="uri">https://CRAN.R-project.org/package=cOde</a>.</p>
</div>
<div id="ref-Kneis2016">
<p>Kneis, David. 2016. <em>rodeo: Handling of Ode-Models as R Objects</em>. <a href="https://github.com/dkneis/rodeo" class="uri">https://github.com/dkneis/rodeo</a>.</p>
</div>
<div id="ref-RCore2015">
<p>R Core Team. 2015. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org/" class="uri">http://www.R-project.org/</a>.</p>
</div>
<div id="ref-Soetaert2010c">
<p>Soetaert, Karline, Thomas Petzoldt, and R. Woodrow Setzer. 2010. “Solving Differential Equations in R.” <em>The R Journal</em> 2 (2): 5–15. <a href="http://journal.r-project.org/archive/2010-2/RJournal_2010-2_Soetaert~et~al.pdf" class="uri">http://journal.r-project.org/archive/2010-2/RJournal_2010-2_Soetaert~et~al.pdf</a>.</p>
</div>
<div id="ref-knitr2014">
<p>Xie, Yihui. 2014. “knitr: A Comprehensive Tool for Reproducible Research in R.” In <em>Implementing Reproducible Computational Research</em>, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. <a href="http://www.crcpress.com/product/isbn/9781466561595" class="uri">http://www.crcpress.com/product/isbn/9781466561595</a>.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
