<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Thomas Petzoldt" />

<meta name="date" content="2017-02-05" />

<title>Estimation of Growth Rates with Package growthrates</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Estimation of Growth Rates with Package <code>growthrates</code></h1>
<h4 class="author"><em>Thomas Petzoldt</em></h4>
<h4 class="date"><em>2017-02-05</em></h4>



<!--
possible output options are:
rmarkdown::pdf_document
rmarkdown::html_vignette

set to UTF if necessary with:
%\VignetteEncoding{UTF-8}

Bibliographies may need to set the LANG environment variable
LANG=en_US.UTF-8
-->
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The growth rate of a population is a direct measure of fitness. Therefore, determination of growth rates is common in many disciplines of theoretical and applied biology, e.g. physiology, ecology, eco-toxicology or pharmacology. This package aims to streamline estimation of growth rates from direct or indirect measures of population density (e.g. cell counts, optical density or fluorescence) determined in batch experiments or field observations. It should be applicable to different species of bacteria, archaea, protists, and metazoa, e.g. <em>E. coli</em>, <em>Cyanobacteria</em>, <em>Paramecium</em>, green algae or <em>Daphnia</em>.</p>
<p>The determination of growth rates from chemostat and semi-continuous cultures is currently not covered by the package, but we are open to include it, depending on your interest and the availability of data. The package is still under development and feedback is highly welcome.</p>
</div>
<div id="methods" class="section level1">
<h1>Methods</h1>
<p>The package includes three types of methods:</p>
<ol style="list-style-type: decimal">
<li>Nonlinear fitting of parametric growth models like the logistic or the Gompertz growth model. Parametric model fitting is done by using package <code>FME</code> (Flexible Modelling Environment) of <span class="citation">Soetaert and Petzoldt (2010)</span>. In addition to growth models given in closed form (i.e. empirical regression equations or analytical solutions of differential equations) it is also possible to use numerically integrated systems of differential equation. Such models are then solved with package `deSolve’ <span class="citation">(Soetaert, Petzoldt, and Setzer 2010)</span>.</li>
<li>Fitting of linear models to the period of exponential growth using the ``growth rates made easy method’’ of <span class="citation">Hall and Barlow (2013)</span> ,</li>
<li>Nonparametric growthrate estimation by using smoothers. R contains several powerful smoothing methods, that can leveraged for this purpose. The currently implemented method uses function <code>smooth.spline</code>, similar to the package <code>grofit</code> <span class="citation">(Kahm et al. 2010)</span>.</li>
</ol>
<p>The package contains methods to fit single data sets or complete series of data sets organized in a data frame. It contains also functions for extracting results (e.g. <code>coef</code>, <code>summary</code>, <code>deviance</code>, <code>obs</code>, <code>residuals</code>, <code>rsquared</code> and <code>results</code>) and methods for plotting (<code>plot</code>, <code>lines</code>). The implementation follows an object oriented style, so that the functions above determine automatically which method is used for a given class of objects.</p>
</div>
<div id="data-set" class="section level1">
<h1>Data set</h1>
<p>The data set for demonstrating main features of the package was provided by Claudia Seiler from one of a series of plate reader experiments carried out at the Institute of Hydrobiology of TU Dresden. It describes growth of three different strains of bacteria (D = Donor, R = Recipient, T = transconjugant) in dependence of a gradient of the antibiotics tetracycline.</p>
<p>After loading the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;growthrates&quot;</span>)</code></pre></div>
<p>we load the data and inspect its structure with <code>str</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(bactgrowth)
<span class="kw">str</span>(bactgrowth)</code></pre></div>
<pre><code>## 'data.frame':    2232 obs. of  5 variables:
##  $ strain   : Factor w/ 3 levels &quot;D&quot;,&quot;R&quot;,&quot;T&quot;: 3 3 3 3 3 3 3 3 3 3 ...
##  $ replicate: int  2 2 2 2 2 2 2 2 2 2 ...
##  $ conc     : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ time     : int  0 1 2 3 4 5 6 7 8 9 ...
##  $ value    : num  0.013 0.014 0.017 0.022 0.03 0.039 0.042 0.045 0.048 0.049 ...</code></pre>
<p>And we can also inspect the full data set with <code>View(growthrates)</code> or look at the first few lines with <code>head</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(bactgrowth)</code></pre></div>
<pre><code>##   strain replicate conc time value
## 1      T         2    0    0 0.013
## 2      T         2    0    1 0.014
## 3      T         2    0    2 0.017
## 4      T         2    0    3 0.022
## 5      T         2    0    4 0.030
## 6      T         2    0    5 0.039</code></pre>
<p>or we can plot raw data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)
<span class="kw">data</span>(bactgrowth)
<span class="kw">xyplot</span>(value ~<span class="st"> </span>time|strain+<span class="kw">as.factor</span>(conc), <span class="dt">data =</span> bactgrowth,
       <span class="dt">groups =</span> replicate, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>)</code></pre></div>
</div>
<div id="estimation-of-growth-rates" class="section level1">
<h1>Estimation of growth rates</h1>
<p>Package <strong>growthrates</strong> can determine growth parameters from single experiments, from a complete series of experiments, or from subsets in one step. Here we start with an overview over the ``single subset’’-methods and show then examples for fitting growth models to the full data set. More examples can be found on the help pages of the package.</p>
<div id="fitting-models-to-single-data-sets" class="section level2">
<h2>Fitting models to single data sets</h2>
<p>Single data sets can be analysed with functions <code>fit_easylinear</code>, <code>fit_growthmodels</code> or <code>fit_splines</code>. As a prerequisite, single data sets containing only one treatment have to be extracted from a complete experiment, which can be done with function `multsiplit’. In the following example, the full data table is first split into a list of experiments according to a vector of criteria and then the first experiment is extracted:</p>
<div id="easy-linear-method" class="section level3">
<h3>Easy Linear Method</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">splitted.data &lt;-<span class="st"> </span><span class="kw">multisplit</span>(bactgrowth, <span class="kw">c</span>(<span class="st">&quot;strain&quot;</span>, <span class="st">&quot;conc&quot;</span>, <span class="st">&quot;replicate&quot;</span>))
dat &lt;-<span class="st"> </span>splitted.data[[<span class="dv">1</span>]]</code></pre></div>
<p>In the next step, model fitting is done, e.g. with the “easylinear” method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">fit_easylinear</span>(dat$time, dat$value)</code></pre></div>
<p>This method fits segments of linear models to the log-transformed data and tries to find the maximum growth rate. Several functions exist to inspect the outcome of the model fit, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(fit)      <span class="co"># exponential growth parameters</span>
<span class="kw">rsquared</span>(fit)  <span class="co"># coefficient of determination (of log-transformed data)</span>
<span class="kw">deviance</span>(fit)  <span class="co"># residual sum of squares of log-transformed data</span></code></pre></div>
<p>Plotting can then be done either in log-scale or after re-transformation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(fit, <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>)
<span class="kw">plot</span>(fit)</code></pre></div>
<p>and in addition to the original method of <span class="citation">Hall and Barlow (2013)</span> it is also possible to modify the default settings of the algorithm:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fitx &lt;-<span class="st"> </span><span class="kw">fit_easylinear</span>(dat$time, dat$value, <span class="dt">h =</span> <span class="dv">8</span>, <span class="dt">quota =</span> <span class="fl">0.95</span>)
<span class="kw">plot</span>(fit)
<span class="kw">lines</span>(fitx, <span class="dt">pch =</span> <span class="st">&quot;+&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
</div>
</div>
<div id="parametric-nonlinear-growth-models" class="section level2">
<h2>Parametric nonlinear growth models</h2>
<p>A <strong>parametric growth model</strong> consists of a mathematical formula that describes the growth of a population (e.g. <code>grow_logistic</code>) and its parameters (e.g. <code>y0</code>, <code>mumax</code>, and <code>K</code>,). <strong>Fitting a parametric model</strong> is the process of estimating an optimal parameter set that minimizes a given quality criterion. Here we use the <em>method of least squares</em>, also known as <em>ordinary least squares regression</em> (OLS). As most of the growth models are non-linear, we need always a goof set of start parameters <code>p</code>. It is wise to choose values for start parameters carefully by considering the main properties of the selected growth model (e.g. that the carrying capacity <code>K</code> should be around the observed maximum of the data), or by experimentation, i.e. plotting the model together with the data. In order to prevent unrealistic (e.g. negative) parameter values, it is optionally possible to specify box-constraints (<code>upper</code> and <code>lower</code>). For difficult problems one may consider to change the involved model fitting algorithm from Marquardt (<code>&quot;Marq&quot;</code>) to something else, e.g. to <code>&quot;L-BFGS-B&quot;</code>. Details can be found on the <code>?modFit</code> help page.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p     &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">0.01</span>, <span class="dt">mumax =</span> <span class="fl">0.2</span>, <span class="dt">K =</span> <span class="fl">0.1</span>)
lower &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">1e-6</span>, <span class="dt">mumax =</span> <span class="dv">0</span>,   <span class="dt">K =</span> <span class="dv">0</span>)
upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">0.05</span>, <span class="dt">mumax =</span> <span class="dv">5</span>,   <span class="dt">K =</span> <span class="fl">0.5</span>)

fit1 &lt;-<span class="st"> </span><span class="kw">fit_growthmodel</span>(<span class="dt">FUN =</span> grow_logistic, <span class="dt">p =</span> p, dat$time, dat$value,
                        <span class="dt">lower =</span> lower, <span class="dt">upper =</span> upper)

p     &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">yi =</span> <span class="fl">0.02</span>, <span class="dt">ya =</span> <span class="fl">0.001</span>, <span class="dt">kw =</span> <span class="fl">0.1</span>, <span class="dt">mumax =</span> <span class="fl">0.2</span>, <span class="dt">K =</span> <span class="fl">0.1</span>)
lower &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">yi =</span> <span class="fl">1e-6</span>, <span class="dt">ya =</span> <span class="fl">1e-6</span>, <span class="dt">kw =</span> <span class="dv">0</span>,    <span class="dt">mumax =</span> <span class="dv">0</span>,   <span class="dt">K =</span> <span class="dv">0</span>)
upper &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">yi =</span> <span class="fl">0.05</span>, <span class="dt">ya =</span> <span class="fl">0.05</span>, <span class="dt">kw =</span> <span class="dv">10</span>,   <span class="dt">mumax =</span> <span class="dv">5</span>,   <span class="dt">K =</span> <span class="fl">0.5</span>)

fit2 &lt;-<span class="st"> </span><span class="kw">fit_growthmodel</span>(<span class="dt">FUN =</span> grow_twostep, <span class="dt">p =</span> p, <span class="dt">time =</span> dat$time, <span class="dt">y =</span> dat$value,
                        <span class="dt">lower =</span> lower, <span class="dt">upper =</span> upper)

<span class="kw">coef</span>(fit1)
<span class="kw">coef</span>(fit2)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(fit1)
<span class="kw">lines</span>(fit2, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)

<span class="kw">plot</span>(fit1, <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>)
<span class="kw">lines</span>(fit2, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<div id="differential-equation-models" class="section level3">
<h3>Differential equation models</h3>
<p>In the two-step model abode, growth is described as a two-step process of adaption of inactive cells <span class="math inline">\(y_i\)</span> and logistic growth of active cells <span class="math inline">\(y_a\)</span>:</p>
<p><span class="math display">\[\frac{dy_i}{dt} = - k_w \cdot y_i \]</span></p>
<p><span class="math display">\[\frac{dy_a}{dt} =   k_w \cdot y_i + \mu_{max} \cdot
  y_a \cdot \left(1 - \frac{y_a + y_i}{K} \right)\]</span></p>
<p>with amount of total organisms <span class="math inline">\(y = y_i + y_a\)</span>, and an adaption rate <span class="math inline">\(k_w\)</span>, intrinsic growth rate <span class="math inline">\(\mu_{max}\)</span>, and carrying capacity <span class="math inline">\(K\)</span>. The initial abundance (normally <span class="math inline">\(y_0\)</span>) is splitted in two separate values, <span class="math inline">\(y_{i,0}\)</span> and <span class="math inline">\(y_{a,0}\)</span> that are by default also fitted.</p>
<p>The underlying ordinary differential equation (ODE) model has no simple analytical solution and is therefore solved numerically using a differential solver from package <strong>deSolve</strong>. Here both, the model and the solver are running in compiled code (C resp. Fortran), but it is of course also possible to define user-specified models in R code. Details can be found in <em>Part 2</em> of the package documentation.</p>
</div>
<div id="selective-parameter-fitting" class="section level3">
<h3>Selective parameter fitting</h3>
<p>Despite the fact that the above model is solved as a differential equation, the relatively high number of parameters may need special care, too. In such cases, package growthrates allows to fit subsets of parameters while setting the others to fixed values. In the following, this is done by specifying a subset without initial abundances <span class="math inline">\(y_a\)</span> and <span class="math inline">\(y_i\)</span> in <code>which</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit3 &lt;-<span class="st"> </span><span class="kw">fit_growthmodel</span>(<span class="dt">FUN =</span> grow_twostep, <span class="dt">p =</span> p, <span class="dt">time =</span> dat$time, <span class="dt">y =</span> dat$value,
                        <span class="dt">lower =</span> lower, <span class="dt">upper =</span> upper, <span class="dt">which =</span> <span class="kw">c</span>(<span class="st">&quot;kw&quot;</span>, <span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;K&quot;</span>))

<span class="kw">summary</span>(fit3)

<span class="kw">coef</span>(fit3)
<span class="kw">plot</span>(fit3)</code></pre></div>
<p>We see that <code>summary</code> shows only the fitted parameters whereas <code>coef</code> contains the full set.</p>
<p>Note however, that start values need to be given in <code>p</code> for all model parameters, i.e. for both the fitted and the fixed ones, while <code>upper</code> and <code>lower</code> bounds for the fixed parameters can be omitted.</p>
</div>
</div>
<div id="nonparametric-smoothing-splines" class="section level2">
<h2>Nonparametric smoothing splines</h2>
<p>Smoothing splines are a quick method to estimate maximum growth. The method is called <em>nonparametric</em>, because the growth rate is directly estimated from the smoothed data without being restricted to a specific model formula.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span>splitted.data[[<span class="dv">2</span>]]
time &lt;-<span class="st"> </span>dat$time
y    &lt;-<span class="st"> </span>dat$value

## automatic smoothing with cv
res &lt;-<span class="st"> </span><span class="kw">fit_spline</span>(time, y)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(res, <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>)
<span class="kw">plot</span>(res)
<span class="kw">coef</span>(res)</code></pre></div>
</div>
</div>
<div id="fiting-multiple-data-sets" class="section level1">
<h1>Fiting multiple data sets</h1>
<p>Fiting multiple data sets at once is possible with functions <code>all_easyliner</code>, <code>all_growthmodels</code> and <code>all_splines</code>. Usage is similar for all methods, and the parameters are analogous to the single-fit methods. Both, the easy growth rates and the smooting splines method are quite robust. In contrast to this, parametric fits with function <code>all_growthmodels</code> need more care and a little bit more computational power.</p>
<p>Again, special emphasis should be given to the selection of good starting points. In addition, it is possible to select an alternative optimization algorithm, to enable additional output (<code>trace</code>) or to fine-tune their optimization control parameters. Nevertheless, it should be noted that parametric models have more explanatory power and may therefore be advantageous for basic research.</p>
<p>Nonlinear optimization is done with parallelized code, so multi-core computers can speed up computation.</p>
<div id="fitting-smoothing-splines-to-multiple-data" class="section level2">
<h2>Fitting smoothing splines to multiple data</h2>
<p>It can be a good idea, to start with a nonparametric approach like the smoothing spline method to get a first impression and, potentially, to derive start parameters for a parametric model. In the following, we show an example with the smoothing spline method. The function uses a formula interface with the syntax: <code>dependent_variable ~ independent_variable | group1 + group 2 + ...</code>:</p>
<p>In this example, smoothness is set to a moderate value (<code>spar = 0.5</code>). Other values between zero and one will result in different degrees of smoothing. If <code>spar</code> is omitted, leave-one-out cross-validation is used to determine smoothness automatically. This works best if the samples over time are true replicates from independent experimental units, instead of pseudo-replicates with potential autocorrelation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">many_spline_fits &lt;-<span class="st"> </span><span class="kw">all_splines</span>(value ~<span class="st"> </span>time |<span class="st"> </span>strain +<span class="st"> </span>conc +<span class="st"> </span>replicate,
                                <span class="dt">data =</span> bactgrowth, <span class="dt">spar =</span> <span class="fl">0.5</span>)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">6</span>))
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(many_spline_fits)</code></pre></div>
</div>
<div id="fitting-parametric-models-to-multiple-data" class="section level2">
<h2>Fitting parametric models to multiple data</h2>
<p>Package <strong>growthrates</strong> allows to fit parametric models to a series of grouped data. The formula interface of function <code>all_growthmodels</code> allows to include the name of the nonlinear model (the <code>grow_....</code>-function) and the name of the independent variable (e.g. <code>time</code>) as its first argument, for example as <code>grow_logistic(time, parms)</code>. The second argument <code>parms</code> is a dummy argument; its name does currently not (yet) matter. Model fitting can make use of multiple CPU cores to speed up computation. If the <code>ncores</code> argument is omitted, the number of cores is automatically detected while setting <code>ncores = 1</code> can be useful for debugging.</p>
<p>In the following, let’s fit a Baranyi growth model <span class="citation">(Baranyi and Roberts 1995)</span> to the data, a model that considers the lag phase as as a period to build up ``critical substances’’ needed for growth. The model is based on a system of two differential equations for which under some simplifying assumptions an analytical solution was presented.</p>
<p>In a first attempt, we fit all parameters of the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## initial parameters and box constraints
p   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">0.03</span>, <span class="dt">mumax =</span> .<span class="dv">1</span>, <span class="dt">K =</span> <span class="fl">0.1</span>, <span class="dt">h0 =</span> <span class="dv">1</span>)

lower   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">0.001</span>, <span class="dt">mumax =</span> <span class="fl">1e-2</span>, <span class="dt">K =</span> <span class="fl">0.005</span>, <span class="dt">h0 =</span> <span class="dv">0</span>)
upper   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">y0 =</span> <span class="fl">0.1</span>,   <span class="dt">mumax =</span> <span class="dv">1</span>,    <span class="dt">K =</span> <span class="fl">0.5</span>,   <span class="dt">h0 =</span> <span class="dv">10</span>)

## fit growth models to all data using log transformed residuals
many_baranyi1 &lt;-<span class="st"> </span><span class="kw">all_growthmodels</span>(
                   value ~<span class="st"> </span><span class="kw">grow_baranyi</span>(time, parms) |<span class="st"> </span>strain +<span class="st"> </span>conc +<span class="st"> </span>replicate,
                   <span class="dt">data =</span> bactgrowth,
                   <span class="dt">p =</span> p, <span class="dt">lower =</span> lower, <span class="dt">upper =</span> upper,
                   <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">ncores =</span> <span class="dv">2</span>)</code></pre></div>
<p>whereas in a second trial, <code>h0</code> is fixed to a common value to avoid that <code>h0</code> consumes parts of the effect because of interdependency between <code>h0</code> and <code>mumax</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## use coefficients of first fit as new initial parameters
pp   &lt;-<span class="st"> </span><span class="kw">coef</span>(many_baranyi1)
## but set h0 to a fixed value
pp[, <span class="st">&quot;h0&quot;</span>] &lt;-<span class="st"> </span><span class="fl">0.65</span>
## re-fit models
many_baranyi2 &lt;-<span class="st"> </span><span class="kw">all_growthmodels</span>(
                   value ~<span class="st"> </span><span class="kw">grow_baranyi</span>(time, parms) |<span class="st"> </span>strain +<span class="st"> </span>conc +<span class="st"> </span>replicate,
                   <span class="dt">data =</span> bactgrowth,
                   <span class="dt">p =</span> pp, <span class="dt">lower =</span> lower, <span class="dt">upper =</span> upper,
                   <span class="dt">which =</span> <span class="kw">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;K&quot;</span>), <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">ncores =</span> <span class="dv">2</span>)</code></pre></div>
<p>The result of the second fit is shown in the following figure. It may be noted that even better fits are possible with models with more parameters, e.g. <span class="citation">Huang (2011)</span>, again at the cost that the effect of antibiotics is distributed over several correlated parameters instead of an effect of the maximum growth rate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">6</span>))
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(many_baranyi2)</code></pre></div>
</div>
</div>
<div id="finally" class="section level1">
<h1>Finally</h1>
<p>Dependency of growth rate on antibiotic concentration for the three strains with the spline fit and the Baranyi model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">many_spline_res   &lt;-<span class="st"> </span><span class="kw">results</span>(many_spline_fits)
many_baranyi2_res &lt;-<span class="st"> </span><span class="kw">results</span>(many_baranyi2)
<span class="kw">xyplot</span>(mumax ~<span class="st"> </span><span class="kw">log</span>(conc<span class="dv">+1</span>)|strain, <span class="dt">data =</span> many_spline_res, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))
<span class="kw">xyplot</span>(mumax ~<span class="st"> </span><span class="kw">log</span>(conc<span class="dv">+1</span>)|strain, <span class="dt">data =</span> many_baranyi2_res, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</code></pre></div>
<p>Describing the observed dependency can again be approached with nonparametric methods or parametric functional response curves, which may be done by using a specialized package for dose-response curves, for example package <strong>drc</strong> <span class="citation">(Ritz and Streibig 2005)</span>.</p>
</div>
<div id="acknowledgments" class="section level1">
<h1>Acknowledgments</h1>
<p>Many thanks to Claudia Seiler for the data set, and to the R Core Team <span class="citation">(R Core Team 2015)</span> for developing and maintaining <strong>R</strong>. This documentation was written using <strong>knitr</strong> <span class="citation">(Xie 2014)</span> and <strong>rmarkdown</strong> <span class="citation">(Allaire et al. 2015)</span>.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-rmarkdown">
<p>Allaire, JJ, Joe Cheng, Yihui Xie, Jonathan McPherson, Winston Chang, Jeff Allen, Hadley Wickham, and Rob Hyndman. 2015. <em>rmarkdown: Dynamic Documents for R</em>. <a href="http://CRAN.R-project.org/package=rmarkdown" class="uri">http://CRAN.R-project.org/package=rmarkdown</a>.</p>
</div>
<div id="ref-Baranyi1995">
<p>Baranyi, Jozsef, and Terry A. Roberts. 1995. “Mathematics of Predictive Food Microbiology.” <em>International Journal of Food Microbiology</em> 26 (2): 199–218. doi:<a href="https://doi.org/10.1016/0168-1605(94)00121-L">10.1016/0168-1605(94)00121-L</a>.</p>
</div>
<div id="ref-Hall2013">
<p>Hall, Acar, B. G., and M. Barlow. 2013. “Growth Rates Made Easy.” <em>Mol. Biol. Evol.</em> 31: 232–38. doi:<a href="https://doi.org/10.1093/molbev/mst197">10.1093/molbev/mst197</a>.</p>
</div>
<div id="ref-Huang2011">
<p>Huang, Lihan. 2011. “A New Mechanistic Growth Model for Simultaneous Determination of Lag Phase Duration and Exponential Growth Rate and a New Belehdredek-Type Model for Evaluating the Effect of Temperature on Growth Rate.” <em>Food Microbiology</em> 28 (4): 770–76. doi:<a href="https://doi.org/10.1016/j.fm.2010.05.019">10.1016/j.fm.2010.05.019</a>.</p>
</div>
<div id="ref-Kahm2010">
<p>Kahm, Matthias, Guido Hasenbrink, Hella Lichtenberg-Frate, Jost Ludwig, and Maik Kschischo. 2010. “Grofit: Fitting Biological Growth Curves with R.” <em>Journal of Statistical Software</em> 33 (7): 1–21. doi:<a href="https://doi.org/10.18637/jss.v033.i07">10.18637/jss.v033.i07</a>.</p>
</div>
<div id="ref-RCore2015">
<p>R Core Team. 2015. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org/" class="uri">http://www.R-project.org/</a>.</p>
</div>
<div id="ref-Ritz2005">
<p>Ritz, C., and J. C. Streibig. 2005. “Bioassay Analysis Using R.” <em>Journal of Statistical Software</em> 12 (5). <a href="http://www.bioassay.dk" class="uri">http://www.bioassay.dk</a>.</p>
</div>
<div id="ref-Soetaert2010">
<p>Soetaert, Karline, and Thomas Petzoldt. 2010. “Inverse Modelling, Sensitivity and Monte Carlo Analysis in R Using Package FME.” <em>Journal of Statistical Software</em> 33 (3): 1–28. doi:<a href="https://doi.org/10.18637/jss.v033.i03">10.18637/jss.v033.i03</a>.</p>
</div>
<div id="ref-deSolve_jss">
<p>Soetaert, Karline, Thomas Petzoldt, and R. Woodrow Setzer. 2010. “Solving Differential Equations in R: Package deSolve.” <em>Journal of Statistical Software</em> 33 (9): 1–25. doi:<a href="https://doi.org/10.18637/jss.v033.i09">10.18637/jss.v033.i09</a>.</p>
</div>
<div id="ref-knitr2014">
<p>Xie, Yihui. 2014. “knitr: A Comprehensive Tool for Reproducible Research in R.” In <em>Implementing Reproducible Computational Research</em>, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. <a href="http://www.crcpress.com/product/isbn/9781466561595" class="uri">http://www.crcpress.com/product/isbn/9781466561595</a>.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
